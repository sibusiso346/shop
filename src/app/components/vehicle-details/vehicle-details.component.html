<div class="vehicle-details-container">
  @if (isLoading()) {
    <div class="loading">
      <div class="loading-spinner"></div>
      <p>Loading vehicle details...</p>
    </div>
  } @else if (vehicle()) {
    <div class="vehicle-details">
      <!-- Back Button -->
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m15 18-6-6 6-6"/>
        </svg>
        Back to Vehicles
      </button>

      <div class="vehicle-content">
        <!-- Image Gallery -->
        <div class="image-gallery">
          <div class="main-image">
            <img [src]="vehicle()?.imageUrl || 'https://via.placeholder.com/600x400?text=No+Image'" 
                 [alt]="vehicle()?.make + ' ' + vehicle()?.model"
                 class="vehicle-image">
            @if (vehicle()?.images && vehicle()?.images!.length > 1) {
              <button class="nav-btn prev-btn" (click)="prevImage()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m15 18-6-6 6-6"/>
                </svg>
              </button>
              <button class="nav-btn next-btn" (click)="nextImage()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </button>
            }
          </div>
          
          @if (vehicle()?.images && vehicle()?.images!.length > 1) {
            <div class="thumbnail-gallery">
              @for (image of vehicle()?.images!; track $index) {
                <img [src]="image" 
                     [alt]="vehicle()?.make + ' ' + vehicle()?.model + ' - Image ' + ($index + 1)"
                     class="thumbnail"
                     [class.active]="$index === currentImageIndex()"
                     (click)="currentImageIndex.set($index)">
              }
            </div>
          }
        </div>

        <!-- Vehicle Info -->
        <div class="vehicle-info">
          <div class="vehicle-header">
            <h1 class="vehicle-title">{{ vehicle()?.year }} {{ vehicle()?.make }} {{ vehicle()?.model }}</h1>
            <div class="price-badge">
              <span class="price">{{ formatPrice(vehicle()?.price || 0) }}</span>
            </div>
          </div>

          <div class="vehicle-meta">
            <div class="meta-item">
              <span class="meta-label">Category:</span>
              <span class="meta-value">{{ vehicle()?.category }}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Mileage:</span>
              <span class="meta-value">{{ formatMileage(vehicle()?.mileage || 0) }} miles</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Condition:</span>
              <span class="meta-value condition-badge" [class]="'condition-' + vehicle()?.condition?.toLowerCase()">
                {{ vehicle()?.condition }}
              </span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Location:</span>
              <span class="meta-value">{{ vehicle()?.location }}</span>
            </div>
          </div>

          <div class="vehicle-specs">
            <h3>Specifications</h3>
            <div class="specs-grid">
              <div class="spec-item">
                <span class="spec-label">Fuel Type:</span>
                <span class="spec-value">{{ vehicle()?.fuelType }}</span>
              </div>
              <div class="spec-item">
                <span class="spec-label">Transmission:</span>
                <span class="spec-value">{{ vehicle()?.transmission }}</span>
              </div>
              <div class="spec-item">
                <span class="spec-label">Color:</span>
                <span class="spec-value">{{ vehicle()?.color }}</span>
              </div>
              @if (getCategorySpecificDetails(vehicle()!)) {
                <div class="spec-item">
                  <span class="spec-label">Details:</span>
                  <span class="spec-value">{{ getCategorySpecificDetails(vehicle()!) }}</span>
                </div>
              }
            </div>
          </div>

          <div class="vehicle-description">
            <h3>Description</h3>
            <p>{{ vehicle()?.description || 'No description provided.' }}</p>
          </div>

          <div class="seller-info">
            <h3>Seller Information</h3>
            <div class="seller-details">
              <div class="seller-item">
                <span class="seller-label">Name:</span>
                <span class="seller-value">{{ vehicle()?.sellerName }}</span>
              </div>
              <div class="seller-item">
                <span class="seller-label">Contact:</span>
                <span class="seller-value">{{ vehicle()?.sellerContact }}</span>
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn btn-primary contact-btn" (click)="toggleContactForm()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              Contact Seller
            </button>
            <button class="btn btn-secondary">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"/>
              </svg>
              Add to Favorites
            </button>
          </div>

          @if (showContactForm()) {
            <div class="contact-form">
              <h3>Contact Seller</h3>
              <form class="contact-form-content">
                <div class="form-group">
                  <label for="name">Your Name</label>
                  <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                  <label for="email">Your Email</label>
                  <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                  <label for="phone">Your Phone</label>
                  <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                  <label for="message">Message</label>
                  <textarea id="message" name="message" rows="4" 
                            placeholder="I'm interested in this vehicle. Please contact me with more details."></textarea>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn btn-primary">Send Message</button>
                  <button type="button" class="btn btn-secondary" (click)="toggleContactForm()">Cancel</button>
                </div>
              </form>
            </div>
          }
        </div>
      </div>
    </div>
  } @else {
    <div class="error">
      <h2>Vehicle Not Found</h2>
      <p>The vehicle you're looking for doesn't exist or has been removed.</p>
      <button class="btn btn-primary" (click)="goBack()">Back to Vehicles</button>
    </div>
  }
</div>
