<div class="payment-container">
  <div class="payment-header">
    <h2>Payment</h2>
    <div class="payment-summary">
      <div class="amount-display">
        <span class="currency">{{ paymentDetails.currency }}</span>
        <span class="amount">{{ paymentDetails.amount | number:'1.2-2' }}</span>
      </div>
      <p class="description">{{ paymentDetails.description }}</p>
    </div>
  </div>

  <!-- Payment Methods -->
  <div class="payment-methods-section">
    <h3>Select Payment Method</h3>
    <div class="payment-methods-grid">
      @for (method of paymentMethods; track method.id) {
        <div 
          class="payment-method-card"
          [class.selected]="selectedMethod === method.id"
          [class.unavailable]="!method.isAvailable"
          (click)="selectPaymentMethod(method.id)"
        >
          <div class="method-icon">
            @switch (method.icon) {
              @case ('credit-card') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                  <line x1="1" y1="10" x2="23" y2="10"/>
                </svg>
              }
              @case ('bank') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="3" y1="21" x2="21" y2="21"/>
                  <line x1="5" y1="21" x2="5" y2="3"/>
                  <line x1="9" y1="21" x2="9" y2="3"/>
                  <line x1="15" y1="21" x2="15" y2="3"/>
                  <line x1="19" y1="21" x2="19" y2="3"/>
                </svg>
              }
              @case ('paypal') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.543-.68c-.013-.76-.4-1.43-1.003-1.928C18.33 3.05 16.389 2.5 13.458 2.5H6.162c-.524 0-.968.382-1.05.9L2.47 20.597h4.606l1.12-7.106c.082-.518.526-.9 1.05-.9h2.19c4.298 0 7.664-1.747 8.647-6.797.03-.149.054-.294.077-.437.292-1.867-.002-3.137-1.012-4.287z"/>
                </svg>
              }
              @case ('apple-pay') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                </svg>
              }
              @case ('google-pay') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
              }
              @case ('bitcoin') {
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.638 14.904c-1.602 6.43-8.113 10.34-14.542 8.736C2.67 22.05-1.244 15.525.362 9.105 1.962 2.67 8.475-1.243 14.9.358c6.43 1.605 10.342 8.115 8.738 14.546z"/>
                </svg>
              }
            }
          </div>
          <div class="method-info">
            <h4>{{ method.name }}</h4>
            <p>{{ method.description }}</p>
            <div class="method-details">
              <span class="fees">{{ method.fees }}% fee</span>
              <span class="processing-time">{{ method.processingTime }}</span>
            </div>
          </div>
          <div class="method-selector">
            <div class="radio-button" [class.selected]="selectedMethod === method.id">
              <div class="radio-inner"></div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Customer Information -->
  <div class="customer-info-section">
    <h3>Customer Information</h3>
    <div class="form-row">
      <div class="form-group">
        <label for="customerName">Full Name *</label>
        <input 
          type="text" 
          id="customerName"
          [(ngModel)]="paymentDetails.customerInfo.name"
          name="customerName"
          placeholder="Enter your full name"
          required
        >
      </div>
      <div class="form-group">
        <label for="customerEmail">Email Address *</label>
        <input 
          type="email" 
          id="customerEmail"
          [(ngModel)]="paymentDetails.customerInfo.email"
          name="customerEmail"
          placeholder="Enter your email"
          required
        >
      </div>
    </div>
    <div class="form-group">
      <label for="customerPhone">Phone Number *</label>
      <input 
        type="tel" 
        id="customerPhone"
        [(ngModel)]="paymentDetails.customerInfo.phone"
        name="customerPhone"
        placeholder="Enter your phone number"
        required
      >
    </div>
  </div>

  <!-- Billing Address -->
  <div class="billing-address-section">
    <h3>Billing Address</h3>
    <div class="form-group">
      <label for="street">Street Address *</label>
      <input 
        type="text" 
        id="street"
        [(ngModel)]="paymentDetails.billingAddress.street"
        name="street"
        placeholder="Enter street address"
        required
      >
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="city">City *</label>
        <input 
          type="text" 
          id="city"
          [(ngModel)]="paymentDetails.billingAddress.city"
          name="city"
          placeholder="Enter city"
          required
        >
      </div>
      <div class="form-group">
        <label for="state">State *</label>
        <input 
          type="text" 
          id="state"
          [(ngModel)]="paymentDetails.billingAddress.state"
          name="state"
          placeholder="Enter state"
          required
        >
      </div>
      <div class="form-group">
        <label for="zipCode">ZIP Code *</label>
        <input 
          type="text" 
          id="zipCode"
          [(ngModel)]="paymentDetails.billingAddress.zipCode"
          name="zipCode"
          placeholder="Enter ZIP code"
          required
        >
      </div>
    </div>
    <div class="form-group">
      <label for="country">Country *</label>
      <select 
        id="country"
        [(ngModel)]="paymentDetails.billingAddress.country"
        name="country"
        required
      >
        <option value="United States">United States</option>
        <option value="Canada">Canada</option>
        <option value="United Kingdom">United Kingdom</option>
        <option value="Australia">Australia</option>
        <option value="Germany">Germany</option>
        <option value="France">France</option>
        <option value="Other">Other</option>
      </select>
    </div>
  </div>

  <!-- Card Payment Form -->
  @if (showCardForm) {
    <div class="card-payment-section">
      <h3>Card Details</h3>
      <div class="form-group">
        <label for="cardNumber">Card Number *</label>
        <input 
          type="text" 
          id="cardNumber"
          (input)="formatCardNumber($event)"
          placeholder="1234 5678 9012 3456"
          maxlength="19"
          required
        >
      </div>
      <div class="form-group">
        <label for="nameOnCard">Name on Card *</label>
        <input 
          type="text" 
          id="nameOnCard"
          [(ngModel)]="paymentDetails.cardDetails!.nameOnCard"
          name="nameOnCard"
          placeholder="Enter name as it appears on card"
          required
        >
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="expiryDate">Expiry Date *</label>
          <input 
            type="text" 
            id="expiryDate"
            (input)="formatExpiryDate($event)"
            placeholder="MM/YY"
            maxlength="5"
            required
          >
        </div>
        <div class="form-group">
          <label for="cvv">CVV *</label>
          <input 
            type="text" 
            id="cvv"
            (input)="formatCVV($event)"
            placeholder="123"
            maxlength="4"
            required
          >
        </div>
      </div>
    </div>
  }

  <!-- Bank Transfer Form -->
  @if (showBankForm) {
    <div class="bank-payment-section">
      <h3>Bank Details</h3>
      <div class="form-group">
        <label for="accountHolderName">Account Holder Name *</label>
        <input 
          type="text" 
          id="accountHolderName"
          [(ngModel)]="paymentDetails.bankDetails!.accountHolderName"
          name="accountHolderName"
          placeholder="Enter account holder name"
          required
        >
      </div>
      <div class="form-group">
        <label for="accountNumber">Account Number *</label>
        <input 
          type="text" 
          id="accountNumber"
          (input)="formatAccountNumber($event)"
          placeholder="Enter account number"
          maxlength="12"
          required
        >
      </div>
      <div class="form-group">
        <label for="routingNumber">Routing Number *</label>
        <input 
          type="text" 
          id="routingNumber"
          (input)="formatRoutingNumber($event)"
          placeholder="Enter routing number"
          maxlength="9"
          required
        >
      </div>
    </div>
  }

  <!-- Digital Payment Forms -->
  @if (showDigitalForm) {
    <div class="digital-payment-section">
      <h3>{{ getSelectedMethod()?.name }}</h3>
      <div class="digital-payment-info">
        <p>You will be redirected to {{ getSelectedMethod()?.name }} to complete your payment securely.</p>
        <div class="security-badges">
          <span class="security-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              <path d="M9 12l2 2 4-4"/>
            </svg>
            Secure Payment
          </span>
          <span class="security-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
            Encrypted
          </span>
        </div>
      </div>
    </div>
  }

  <!-- Crypto Payment Form -->
  @if (showCryptoForm) {
    <div class="crypto-payment-section">
      <h3>{{ getSelectedMethod()?.name }} Payment</h3>
      <div class="crypto-payment-info">
        <p>Send the exact amount to the address below:</p>
        <div class="crypto-address">
          <label>Payment Address:</label>
          <div class="address-display">
            <span class="address">1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</span>
            <button type="button" class="copy-btn" (click)="copyToClipboard('1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="crypto-amount">
          <label>Amount to Send:</label>
          <span class="amount">{{ getTotalAmount() | number:'1.8-8' }} BTC</span>
        </div>
      </div>
    </div>
  }

  <!-- Payment Summary -->
  <div class="payment-summary-section">
    <h3>Payment Summary</h3>
    <div class="summary-details">
      <div class="summary-row">
        <span>Subtotal:</span>
        <span>{{ paymentDetails.currency }} {{ paymentDetails.amount | number:'1.2-2' }}</span>
      </div>
      @if (getProcessingFee() > 0) {
        <div class="summary-row">
          <span>Processing Fee ({{ getSelectedMethod()?.fees }}%):</span>
          <span>{{ paymentDetails.currency }} {{ getProcessingFee() | number:'1.2-2' }}</span>
        </div>
      }
      <div class="summary-row total">
        <span>Total:</span>
        <span>{{ paymentDetails.currency }} {{ getTotalAmount() | number:'1.2-2' }}</span>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="payment-actions">
    <button 
      type="button" 
      class="cancel-btn"
      (click)="cancelPayment()"
      [disabled]="isProcessing"
    >
      Cancel
    </button>
    <button 
      type="button" 
      class="pay-btn"
      (click)="processPayment()"
      [disabled]="isProcessing || !selectedMethod"
    >
      @if (isProcessing) {
        <svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12a9 9 0 11-6.219-8.56"/>
        </svg>
        Processing...
      } @else {
        Pay {{ paymentDetails.currency }} {{ getTotalAmount() | number:'1.2-2' }}
      }
    </button>
  </div>
</div>
