<div class="vehicle-photos-container">
  <div class="photos-header">
    <h3>Vehicle Photos</h3>
    <p>Upload photos from different angles to showcase your vehicle</p>
    <div class="photo-stats">
      <span class="photo-count">{{ totalPhotos }}/{{ maxPhotos }} photos uploaded</span>
      @if (hasUnuploadedPhotos) {
        <button 
          type="button" 
          class="upload-all-btn"
          (click)="uploadAllPhotos()"
        >
          Upload All Photos
        </button>
      }
      @if (requiredPhotosComplete) {
        <span class="completion-status success">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
          All required photos uploaded
        </span>
      }
    </div>
  </div>

  <!-- Photo Categories Form -->
  <div class="photo-categories-form">
    @for (category of photoCategories; track category.id) {
      <div class="photo-category-item" [class.required]="category.required">
        <div class="category-header">
          <div class="category-info">
            <h4>{{ category.name }}</h4>
            <p>{{ category.description }}</p>
            @if (category.required) {
              <span class="required-badge">Required</span>
            } @else {
              <span class="optional-badge">Optional</span>
            }
          </div>
          <div class="category-status">
            @if (category.photo?.isUploaded) {
              <span class="status-success">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                Uploaded
              </span>
            } @else if (category.photo?.isUploading) {
              <span class="status-uploading">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a10 10 0 0 1 10 10"/>
                </svg>
                Uploading...
              </span>
            } @else if (category.photo) {
              <span class="status-pending">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Ready to upload
              </span>
            }
          </div>
        </div>

        <div class="photo-upload-area">
          @if (category.photo) {
            <!-- Photo Preview -->
            <div class="photo-preview-container">
              <div class="photo-preview">
                <img [src]="category.photo.preview" [alt]="category.name">
                
                <!-- Upload Progress -->
                @if (category.photo.isUploading) {
                  <div class="upload-progress-overlay">
                    <div class="progress-bar">
                      <div 
                        class="progress-fill" 
                        [style.width.%]="uploadProgress[category.photo.id] || 0"
                      ></div>
                    </div>
                    <span class="progress-text">{{ (uploadProgress[category.photo.id] || 0) | number:'1.0-0' }}%</span>
                  </div>
                }

                <!-- Upload Status -->
                @if (category.photo.isUploaded) {
                  <div class="upload-status success">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 12l2 2 4-4"/>
                      <circle cx="12" cy="12" r="10"/>
                    </svg>
                  </div>
                }

                <!-- Photo Actions -->
                <div class="photo-actions">
                  @if (!category.photo.isUploaded && !category.photo.isUploading) {
                    <button 
                      type="button" 
                      class="action-btn upload"
                      (click)="uploadPhoto(category.id)"
                      title="Upload photo"
                    >
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17,8 12,3 7,8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                      </svg>
                      Upload
                    </button>
                  }
                  
                  <button 
                    type="button" 
                    class="action-btn remove"
                    (click)="removePhoto(category.id)"
                    title="Remove photo"
                  >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"/>
                      <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                      <line x1="10" y1="11" x2="10" y2="17"/>
                      <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                    Remove
                  </button>
                </div>
              </div>
            </div>
          } @else {
            <!-- Upload Area -->
            <div 
              class="upload-area"
              [class.drag-over]="isDragOver && draggedCategory === category.id"
              (dragover)="onDragOver($event, category.id)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event, category.id)"
              (click)="fileInput.click()"
            >
              <input 
                #fileInput
                type="file"
                accept="image/*"
                (change)="onFileSelected($event, category.id)"
                style="display: none"
              >
              
              <div class="upload-content">
                <div class="upload-icon">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17,8 12,3 7,8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                </div>
                <h5>{{ category.placeholder }}</h5>
                <p>Drag and drop or click to browse</p>
                <div class="upload-hints">
                  <span>• JPG, PNG, WebP supported</span>
                  <span>• Max 10MB per photo</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Form Summary -->
  <div class="form-summary">
    <div class="summary-stats">
      <div class="stat-item">
        <span class="stat-label">Required Photos:</span>
        <span class="stat-value">
          {{ getRequiredPhotosCount() }}/{{ getRequiredPhotosTotal() }}
        </span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Total Photos:</span>
        <span class="stat-value">{{ totalPhotos }}/{{ maxPhotos }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Status:</span>
        <span class="stat-value" [class.success]="requiredPhotosComplete">
          @if (requiredPhotosComplete) {
            Complete
          } @else {
            Incomplete
          }
        </span>
      </div>
    </div>
  </div>
</div>